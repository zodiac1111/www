<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head>
		<title>电量数据</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<link rel="stylesheet" href="/style/normal_ws.css" type="text/css" />
		<link rel="stylesheet" href="/style/sys.css" type="text/css" />
		<link rel="stylesheet" href="/style/table.css" type="text/css" />
		<link href="/style/table.css" type="text/css" rel="stylesheet" />
		<link href="/style/menuExpandable3.css" rel="stylesheet" type="text/css" />
		<script src="/js/wwyfunc.js" type="text/javascript"></script>
		<!-- 基于jquery的日期时间控件所需要的文件 --开始-->
		<link rel="stylesheet" media="all" type="text/css" href="/style/jquery-ui.css" />
		<link rel="stylesheet" media="all" type="text/css" href="/style/jquery-ui-timepicker-addon.css" />
		<script type="text/javascript" src="/js/jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="/js/jquery-ui.min.js"></script>
		<script type="text/javascript" src="/js/jquery-ui.min-zh-CN.js"></script>
		<script type="text/javascript" src="/js/jquery-ui-timepicker-addon.js"></script>
		<script type="text/javascript" src="/js/jquery-ui-timepicker-zh-CN.js"></script>
		<script type="text/javascript" src="/js/jquery-ui-sliderAccess.js"></script>
		<script type="text/javascript" src="/js/reset.js"></script>
		<script type="text/javascript" src="/version.js"></script>
		<!-- 基于jquery的日期时间控件所需要的文件 --结束-->
		<link type="text/css" href="/style/jquery.dataTables.css" rel="stylesheet"  />
		<link type="text/css" href="/style/jquery.dataTables_themeroller.css" rel="stylesheet"  />
		<script type="text/javascript" src="/js/jquery.dataTables.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				var stime_stamp = $("#stime_stamp");
				var etime_stamp = $("#etime_stamp");
				var obtnQurey = $("#btnQuery");
				///按钮,查询历史数据
				obtnQurey.button({
					icons : {
						primary : "ui-icon-search"
					}
				});
				$("#history_tou").hide();
				$.extend($.fn.dataTable.defaults, {//设置表格属性
					"bInfo" : true, //显示一共几条这种信息
					"bFilter" : false, //不要搜索
					"bSort" : false, //不要排序
					"sScrollY" : "320px", //固定高度
					"bPaginate" : false, //不分页
					"bScrollCollapse" : true, //显示滚动条
					//"bRetrieve" : true,
					"bJQueryUI" : true,
					"bDestroy" : true,
					"bAutoWidth" : true
				});
				$("#save_log").hide();
				var oTable = $('#tbl_history_tou').dataTable();
				//$('#tbl_sysReset').dataTable();
				//$('#tbl_history_tou').dataTable();
				obtnQurey.click(function() {
					//$('#tbl_history_tou').dataTable();
					//$("#tr_dat").html("<tr><td colspan=\"23\" ></td></tr>");
					//$("#tr_dat tr td").addClass('load_bgpic_hight');
					if (stime_stamp.val() == "0" || stime_stamp.val() == "") {
						alert("请选择开始时刻")
						return false;
					}
					if (etime_stamp.val() == "0" || etime_stamp.val() == "") {
						alert("请选择截止时刻")
						return false;
					}
					oTable.fnDestroy(false);
					$.post('/goform/get_tou', $("#history_tou").serialize() + "&mtr_no=" + $("#mtr_no").val(), function(result) {
						//$("#tr_dat tr td").removeClass('load_bgpic_hight');
						//$('#tbl_history_tou').dataTable();
						$("#tr_dat").html(result);
						//oTable.fnDestroy();
						oTable = $('#tbl_history_tou').dataTable();
						//$('#tbl_history_tou').dataTable();
						//oTable.fnAdjustColumnSizing();
						//oTable.fnAdjustColumnSizing();
						//oTable.fnUpdate();
						//oTable.fnDraw(false);
					});
				});
			});
		</script>
	</head>
	<body >
		<h1>历史电量</h1>
		<p align="center">
			获取和设置日期时间:
			<label> 表号:
				<input type="text" name="mtr_no" id="mtr_no" size=3 value="0">
			</label><label> 时间范围:
				<input type="text" name="stime" id="stime" readonly class="date">
			</label><label> ~
				<input type="text"
				name="etime" id="etime" readonly class="date">
			</label>
			<button class="ui-button" id="btnQuery" title="查询选中时段和指定表计的电量数据">
				查询
			</button>
			<form id="history_tou" name="history_tou">
				<label> 时间戳(秒):
					<input type="text" name="stime_stamp" id="stime_stamp" value="0" readonly>
				</label><label> ~
					<input type="text" name="etime_stamp" id="etime_stamp" value="0" readonly>
				</label>
				<br>
				<label> 时区偏移(分钟)
					<input type="text" name="timezone" id="timezone" value="0" readonly>
					<input type="text" name="timezone2" id="timezone2" value="0" readonly>
				</label>
			</form>
		</p>
		<table id="tbl_history_tou" class="touTable" border="1">
			<thead>
				<tr>
					<th rowspan="2">序号</th>
					<th rowspan="2">表号</th>
					<th rowspan="2">时刻</th>
					<th colspan="5">正向有功</th>
					<th colspan="5">反向有功</th>
					<th colspan="5">正向无功</th>
					<th colspan="5">反向无功</th>
				</tr>
				<tr>
					<th>总</th>
					<th>尖</th>
					<th>峰</th>
					<th>平</th>
					<th>谷</th>
					<th>总</th>
					<th>尖</th>
					<th>峰</th>
					<th>平</th>
					<th>谷</th>
					<th>总</th>
					<th>尖</th>
					<th>峰</th>
					<th>平</th>
					<th>谷</th>
					<th>总</th>
					<th>尖</th>
					<th>峰</th>
					<th>平</th>
					<th>谷</th>
				</tr>
			</thead>
			<tbody id="tr_dat">

			</tbody>
		</table>
		<script type="text/javascript">
			$(document).ready(function() {
				var timeZone = 8 * 60;
				//时区(分钟)东8区
				var startDateTextBox = $('#stime');
				var endDateTextBox = $('#etime');
				var stime_stamp = document.getElementById("stime_stamp");
				var etime_stamp = document.getElementById("etime_stamp");
				var tz = document.getElementById("timezone");
				var tz2 = document.getElementById("timezone2");
				//开始时间控件的属性设置
				startDateTextBox.datetimepicker({
					maxDate : 0,
					controlType : 'select', //选择方式选时刻
					dateFormat : "yy-mm-dd", //日期格式
					//showSecond: true, //显示秒
					timeFormat : 'HH:mm', //时刻格式
					separator : ' ', //日期时刻分割字符(串)
					//showTimezone: true, //显示时区
					//timezone: '-0800',    //默认时区
					//点击关闭(完成)按钮事件
					//如果开始时间晚于结束时间,则将开始时间设置为结束时间
					onClose : function(dateText, inst) {
						if (endDateTextBox.val() != '') {
							var testStartDate = startDateTextBox.datetimepicker('getDate');
							var testEndDate = endDateTextBox.datetimepicker('getDate');
							if (testStartDate > testEndDate)
								endDateTextBox.datetimepicker('setDate', testStartDate);
						} else {
							//endDateTextBox.val(dateText);
							//stime_stamp.value = etime_stamp.value;
						}
						var testStartDate = startDateTextBox.datetimepicker('getDate');
						if (testStartDate != null)
							stime_stamp.value = testStartDate.getTime() / 1000;
						//Date.parse(endDateTextBox.datetimepicker('getDate'))/1000;
					},
					onSelect : function(selectedDateTime) {//选择时限定开始时间必须早于结束时间
						endDateTextBox.datetimepicker('option', 'minDate', startDateTextBox.datetimepicker('getDate'));
						//tz.value=startDateTextBox.datetimepicker.timezone;
						var testStartDate = startDateTextBox.datetimepicker('getDate');
						tz.value = timeZone;
						//testStartDate.getTimezoneOffset();
						//这里转换成位标准时间,没有时区信息了.
						stime_stamp.value = testStartDate.getTime() / 1000;
						//Date.parse(startDateTextBox.datetimepicker('getDate'))/1000;
					}
				});
				//结束时间控件的属性设置
				endDateTextBox.datetimepicker({
					maxDate : 0, //不能选择未来
					controlType : 'select', //选择方式选时刻
					dateFormat : "yy-mm-dd", //日期格式
					//showSecond: true, //显示秒
					timeFormat : 'HH:mm', //时刻格式
					separator : ' ', //日期时刻分割字符(串)
					//showTimezone: true, //显示时区
					//timezone: '-0800',    //默认时区
					onClose : function(dateText, inst) {//关闭时候判断
						if (startDateTextBox.val() != '') {
							var testStartDate = startDateTextBox.datetimepicker('getDate');
							var testEndDate = endDateTextBox.datetimepicker('getDate');
							if (testStartDate > testEndDate) {
								startDateTextBox.datetimepicker('setDate', testEndDate);
								//stime_stamp.value = testEndDate.getTime() / 1000;
							}
						} else {
							//startDateTextBox.val(dateText);
							//stime_stamp.value = etime_stamp.value;
						}
						var testEndDate = endDateTextBox.datetimepicker('getDate');
						if (testStartDate != null)
							etime_stamp.value = testEndDate.getTime() / 1000;
						//毫秒转化为秒
						//stime_stamp.value=
						//  Date.parse(startDateTextBox.datetimepicker('getDate'))/1000;
					},
					onSelect : function(selectedDateTime) {//选择时候防止误选
						startDateTextBox.datetimepicker('option', 'maxDate', endDateTextBox.datetimepicker('getDate'));
						var testEndDate = endDateTextBox.datetimepicker('getDate');
						tz2.value = timeZone;
						// testEndDate.getTimezoneOffset();
						etime_stamp.value = testEndDate.getTime() / 1000;
					}
				});
			});
		</script>
	</body>
</html>
